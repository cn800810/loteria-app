<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Loteria</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f4f4f4;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 14px;
  background:#fff;
  border-bottom:1px solid #ddd;
}

header button{
  background:none;
  border:none;
  font-size:16px;
}

.title{
  text-align:center;
  font-weight:bold;
}

.title small{
  display:block;
  font-size:12px;
  font-weight:normal;
}

main{
  padding:12px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
}

/* 左列 */
.left-col{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.input-row{
  display:flex;
  gap:6px;
}

.input-row input{
  flex:1;
  padding:10px;
  font-size:18px;
}

.total{
  flex:1;
  background:#fff;
  border:1px solid #ccc;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:bold;
  color:red;
}

.btn{
  padding:10px;
  border:none;
  font-size:14px;
  border-radius:6px;
}

.gray{ background:#e0e0e0; }
.red{ background:#d9534f; color:#fff; }
.green{ background:#5cb85c; color:#fff; }
.blue{ background:#5bc0de; color:#fff; }

/* 中列 */
.mid-col{
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* 右列 */
.right-col{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.big{
  flex:1;
  font-size:18px;
}
</style>
</head>

<body>

<header>
  <button onclick="showRecords()">记录</button>

  <div class="title">
    Loteria
    <small id="period"></small>
  </div>

  <button>设置</button>
</header>

<main>
  <div class="grid">

    <!-- 左列 -->
    <div class="left-col">
      <div class="input-row">
        <input id="input" type="number" />
        <div class="total" id="total">$0.00</div>
      </div>

      <button class="btn gray" onclick="toggleDigits()" id="digitBtn">2位数</button>
      <div style="height:42px"></div>
    </div>

    <!-- 中列 -->
    <div class="mid-col">
      <button class="btn gray" onclick="toggleOrder()" id="orderBtn">号码/数量</button>
      <button class="btn red" onclick="printOrder()">打印</button>
      <button class="btn gray" onclick="clearAll()">全部清除</button>
    </div>

    <!-- 右列 -->
    <div class="right-col">
      <button class="btn green big">电子单</button>
      <button class="btn blue big" onclick="confirmInput()">确认</button>
    </div>

  </div>
</main>

<script>
/* ===== 基础状态 ===== */
let digitMode = 2;       // 2 或 4
let orderMode = "num";  // num = 号码/数量, qty = 数量/号码
let records = [];
const PRICE_2 = 0.25;
const PRICE_4 = 1.00;

/* ===== 初始化日期 ===== */
const today = new Date().toISOString().slice(0,10);
document.getElementById("period").innerText = `${today} [操作员]`;

/* ===== 切换 2/4 位数 ===== */
function toggleDigits(){
  digitMode = digitMode === 2 ? 4 : 2;
  document.getElementById("digitBtn").innerText = digitMode + "位数";
  calculate();
}

/* ===== 切换 输入顺序 ===== */
function toggleOrder(){
  orderMode = orderMode === "num" ? "qty" : "num";
  document.getElementById("orderBtn").innerText =
    orderMode === "num" ? "号码/数量" : "数量/号码";
  calculate();
}

/* ===== 解析输入 ===== */
function parseInput(){
  const val = document.getElementById("input").value;
  if(!val) return null;

  let num, qty;
  if(orderMode === "num"){
    num = val.slice(0, digitMode);
    qty = val.slice(digitMode);
  }else{
    qty = val.slice(0, val.length - digitMode);
    num = val.slice(-digitMode);
  }

  if(num.length !== digitMode || qty === "") return null;

  return {
    num,
    qty: parseInt(qty)
  };
}

/* ===== 计算合计 ===== */
function calculate(){
  const parsed = parseInput();
  let total = 0;
  if(parsed){
    const price = digitMode === 2 ? PRICE_2 : PRICE_4;
    total = parsed.qty * price;
  }
  document.getElementById("total").innerText = `$${total.toFixed(2)}`;
}

/* ===== 确认 ===== */
function confirmInput(){
  calculate();
}

/* ===== 打印 ===== */
function printOrder(){
  const parsed = parseInput();
  if(!parsed) return alert("输入无效");

  const price = digitMode === 2 ? PRICE_2 : PRICE_4;
  records.push({
    date: today,
    num: parsed.num,
    qty: parsed.qty,
    total: parsed.qty * price
  });

  clearAll();
}

/* ===== 清除 ===== */
function clearAll(){
  document.getElementById("input").value = "";
  document.getElementById("total").innerText = "$0.00";
}

/* ===== 查看记录（临时） ===== */
function showRecords(){
  if(records.length === 0) return alert("暂无记录");
  let text = records.map(r =>
    `${r.date}  ${r.num} x${r.qty}  $${r.total.toFixed(2)}`
  ).join("\n");
  alert(text);
}

/* ===== 实时计算 ===== */
document.getElementById("input").addEventListener("input", calculate);
document.getElementById("input").addEventListener("keydown", e=>{
  if(e.key==="Enter") confirmInput();
});
</script>

</body>
</html>
